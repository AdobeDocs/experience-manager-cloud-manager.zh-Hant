---
title: 僅限舞台和僅限生產環境的配管
description: 瞭解如何使用專用管道來分割中繼和生產部署。
source-git-commit: c09fbf30270523018a36b128d43cbf10e65daf54
workflow-type: tm+mt
source-wordcount: '842'
ht-degree: 1%

---


# 僅限中繼和僅限生產的管道 {#stage-prod-only}

瞭解如何使用專用管道來分割中繼和生產部署。

>[!NOTE]
>
>此功能僅適用於[早期採用者方案。](/help/release-notes/current.md#early-adoption)

## 概觀 {#overview}

中繼和生產環境會緊密結合。 依預設，對它們進行的部署會連結到單一管道。 這是部署管道部署到該計畫中的中繼和生產環境。 雖然此耦合通常適用，但在某些使用案例中存在缺點：

* 如果您只想部署至階段，您只能拒絕 **提升至生產環境** 在管道中步驟。 不過，執行會被標示為已取消。
* 如果您希望將中繼環境中的最新計畫碼部署到生產環境，則需要重新部署整個管道，包括中繼部署，即使那裡未變更計畫碼。
* 由於部署期間無法更新環境，如果您想在升級至生產之前在中繼環境中暫停並測試多天，則無法更新生產環境。 這會產生非相依任務，例如更新 [環境變數](/help/getting-started/build-environment.md#environment-variables) 不可能。

僅限舞台和僅限生產環境的管道提供專用部署選項，針對這些使用案例提供解決方案。

* **僅限中繼的部署管道** 僅部署到中繼環境，並在完成部署和測試後執行完成。
   * 僅限中繼管道的行為與標準耦合完整棧疊生產管道相同，但無需生產部署步驟（核准、排程、部署）。
* **僅限生產環境的部署管道** 僅部署至生產環境，可選擇在「階段」上選取已成功完成並驗證的執行專案，並在「生產」上部署其成品。
   * 僅限生產環境的管道將重複使用階段部署的成品，跳過建置階段。

當完整棧疊生產管道正在執行時，不會執行stage-only或prod-only管道，反之亦然。

這些專用管道可提供更多彈性，但請注意下列操作和建議的詳細資訊。

>[!NOTE]
>
>僅限生產管道一律會使用僅限中繼管道的成品，無論在此期間是否可能透過標準耦合生產管道部署在中繼上。
>
>* 這可能會導致不必要的程式碼回滾。
>* Adobe建議您在開始使用「僅限生產」和「僅限階段」管道後，即停止使用標準耦合生產管道。
>* 如果您仍然決定執行標準耦合管道和僅階段/生產管道，請牢記重複使用成品以避免程式碼倒回。

## 管道建立 {#pipeline-creation}

「僅限生產」和「僅限階段」配管會以與標準耦合類似的方式建立 [生產管道](/help/using/production-pipelines.md) 和 [非生產管道。](/help/using/non-production-pipelines.md) 請參閱這些檔案以取得詳細資料。

1. 在 **管道** 視窗，點選或按一下 **新增管道**.

   * 選取 **新增非生產管道** 以建立僅限階段的管線。
   * 選取 **新增僅限生產的管道** 以建立僅限生產用的配管。

   ![建立生產/僅限階段管線](/help/assets/configure-pipelines/prod-stage-pipelines.png)

>[!NOTE]
>
>如果對應的管道已存在，則某些選項可能會呈灰色。
>
>* **新增僅限生產的管道** 如果僅中繼管道尚不存在，則將無法使用。
>* **新增生產管道** 如果標準耦合管道已存在，則將無法使用。
>* 每個方案只允許一個僅生產管道和一個僅階段管道。

### 僅限階段的管道 {#stage-only}

1. 一旦您選取 **新增非生產管道** 選項， **新增非生產管道** 對話方塊開啟。
1. 若要建立僅限中繼的管道，請在中選取中繼環境 **符合資格的部署環境** 您的管道的欄位。 完成其餘欄位，然後點選或按一下 **繼續**.

   ![建立僅限中繼的管道](/help/assets/configure-pipelines/stage-only.png)

1. 在 **中繼測試** 索引標籤上，您就可以定義應在測試環境中執行的測試。 點選或按一下 **儲存** 以儲存您的新管道。

   ![僅限階段管道的測試引數](/help/assets/configure-pipelines/stage-only-test.png)

### 僅限Prod的管線 {#prod-only}

1. 一旦您選取 **新增僅限生產的管道** 選項， **新增僅限生產的管道** 對話方塊開啟。
1. 提供 **管道名稱**. 對話方塊的其餘選項和功能與標準耦合配管建立對話方塊中的選項和功能相同。 點選或按一下 **儲存** 以儲存管道。

   ![建立僅限生產的管道](/help/assets/configure-pipelines/prod-only-pipeline.png)

## 執行Prod-Only和Stage-Only配管 {#running}

「僅限生產」和「僅限階段」配管的執行方式與 [所有其他管道都會執行。](/help/using/managing-pipelines.md#running-pipelines) 如需詳細資訊，請參閱此檔案。

此外，只能從階段專用管道的執行詳細資訊直接觸發僅限生產管道執行。

### 僅限階段的管道 {#stage-only-run}

階段專用管道的執行方式與標準耦合管道幾乎相同。 不過，在執行結束時，在測試步驟之後， **提升組建** 按鈕可讓您啟動僅限prod的管道執行，該執行會使用此執行在stage上部署的成品，並將其部署到生產環境。

![僅中繼管道執行](/help/assets/configure-pipelines/stage-only-pipeline-run.png)

此 **提升組建** 按鈕僅在您處於最新成功的僅階段管道執行時顯示。 點選或按一下後，系統會要求您確認僅生產管道的執行，或建立僅生產管道（如果尚未存在）。

### 僅限Prod的管線 {#prod-only-run}

對於僅限生產環境的管道，請務必識別要部署到生產環境的來源人工因素。 這些詳細資料可在以下網址找到： **成品準備** 步驟。 您可以導覽至這些執行，以取得進一步的詳細資訊和記錄。

![成品詳細資料](/help/assets/configure-pipelines/prod-only-pipeline-run.png)
