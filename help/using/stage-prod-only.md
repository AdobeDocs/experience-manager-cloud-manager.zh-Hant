---
title: 分割僅限階段和僅限生產的管道
description: 了解如何使用專用管道，分割中繼和生產部署。
exl-id: b7dd0021-d346-464a-a49e-72864b01cce3
source-git-commit: 92237ea156e3921b5dc55cea3abdecee9d26b14b
workflow-type: tm+mt
source-wordcount: '917'
ht-degree: 94%

---

# 分割僅限階段和僅限生產的管道 {#stage-prod-only}

您可以使用專用管道來分割中繼和生產部署。

## 概觀 {#overview}

中繼環境和生產環境緊密耦合。依預設，其部署連結到單一管道。也就是同時部署到該方案中的中繼環境和生產環境的部署管道。雖然這種耦合通常是適當的，但對某些使用案例來說卻存在缺點：

* 如果您想部署到僅限中繼，您會拒絕管道中的「**提升至生產**」步驟。然而，該執行會被標記為已取消。
* 如果您想將中繼環境中的最新程式碼部署到生產環境中，則需要重新部署整個管道，包括中繼部署，即使其中的程式碼未變更。
* 部署期間無法更新環境。如果您於提升至生產前暫停流程，在中繼環境中測試幾天，則生產環境會維持鎖定狀態且無法更新。此情境會使無相依性的工作 (例如更新[環境變數](/help/getting-started/build-environment.md#environment-variables)) 無法進行。

僅限中繼和僅限生產的管道透過提供專用部署選項為這些使用案例提供解決方案。

* **僅限中繼部署管道：**&#x200B;僅部署到中繼環境，在部署和測試完成後，執行即完成。僅限中繼管道的行為與標準耦合全端生產管道相同，但沒有生產部署步驟 (核准、排程、部署)。
* **僅限生產部署管道：**&#x200B;選取最新的成功階段執行來，只部署到生產環境。然後將其成品部署到生產中。僅限生產管道重複使用中繼部署成品，繞過建置階段。

當全端生產管道正在進行時，僅限中繼管道和僅限生產管道不會執行，反之亦然。如果僅限中繼和全端生產管道皆設定「**在 Git 變更時**」觸發程序，並且指向相同的分支與存放庫，則只有僅限中繼管道會自動啟動。僅限生產管道不會啟動 **`On Git Changes`**，因其沒有直接連結到存放庫。

僅限生產管道為手動觸發，因其沒有針對「**在 Git 變更時**」直接連結到存放庫。

這些專用管道提供更大的彈性，但請注意以下操作細節和建議。

>[!NOTE]
>
>僅限生產管道需始終使用僅限中繼管道中的成品。即使標準耦合生產管道同時部署了其他要中繼的內容，此流程仍然有效。
>
>* 這種情境可能會導致不必要的程式碼復原。
>* Adobe 建議在開始使用僅限生產和僅限中繼管道後，停止使用標準耦合生產管道。
>* 如果您仍然決定執行標準耦合管道和僅限中繼/僅限生產管道，請記住重複使用成品以避免程式碼回復。

## 管道建立 {#pipeline-creation}

僅限生產和僅限中繼管道的建立方式類似於標準耦合[生產管道](/help/using/production-pipelines.md)和[非生產管道](/help/using/non-production-pipelines.md)。請參閱這些文件，以了解詳細資訊。

1. 在&#x200B;**管道**&#x200B;視窗中，按一下&#x200B;**新增管道**。

   * 選取&#x200B;**新增非生產管道**&#x200B;以建立僅限中繼管道。
   * 選取&#x200B;**新增僅限生產管道**&#x200B;以建立僅限生產管道。

   ![建立僅限生產/中繼管道](/help/assets/configure-pipelines/prod-stage-pipelines.png)

>[!NOTE]
>
>如果對應的管道已存在，特定選項可能會呈現灰色。
>
>* 如果僅限中繼管道尚不存在，則&#x200B;**新增僅限生產管道**&#x200B;無法使用。
>* 如果標準耦合管道已存在，則&#x200B;**新增生產管道**&#x200B;無法使用。
>* 每個方案僅允許一個僅限生產管道和一個僅限中繼管道。

### 僅限中繼管道 {#stage-only}

1. 選取「**新增非生產管道**」選項後，「**新增非生產管道**」對話框會開啟。
1. 若要建立僅限中繼管道，請在管道的「**合格的部署環境**」欄位中選取中繼環境。
1. 完成剩餘欄位。
1. 按一下「**繼續**」。

   ![建立僅限中繼管道](/help/assets/configure-pipelines/stage-only.png)

1. 於「**中繼測試**」標籤上，定義要在中繼環境中執行的測試。
1. 按一下「**儲存**」。

   ![僅限中繼管道的測試參數](/help/assets/configure-pipelines/stage-only-test.png)

### 僅限生產管道 {#prod-only}

1. 在您按一下&#x200B;**新增僅限生產的管道**&#x200B;後，其相關的對話方塊會開啟。
1. 在「**管道名稱**」欄位中輸入想要的名稱。此對話框的其餘選項和功能，與標準耦合管道建立對話框中的選項和功能相同。
1. 在對話框右下角，按一下「**儲存**」。

   ![建立僅限生產管道](/help/assets/configure-pipelines/prod-only-pipeline.png)

## 執行僅限生產和僅限中繼管道 {#running}

僅限生產和僅限中繼管道的執行方式與[所有其他管道的執行方式](/help/using/managing-pipelines.md#running-pipelines)大致相同。如需詳細資訊，請參閱文件。然而，這些管道有兩項新功能。

* 僅限中繼和僅限生產管道提供新的「[緊急模式](#emergency-mode)」，可略過測試。
* 僅限生產管道的執行可以直接從[僅限中繼管道](#stage-only-run)的執行詳細資訊觸發。

### 緊急模式 {#emergency-mode}

啟動僅限生產和僅限中繼管道時，系統會提示您確認啟動操作及其啟動方式。

* **正常模式**&#x200B;為標準執行，包含中繼測試步驟。
* **緊急模式**&#x200B;跳過中繼測試步驟。

![緊急模式](/help/assets/configure-pipelines/emergency-mode.png)

### 僅限中繼管道 {#stage-only-run}

僅限中繼管道的執行方式與標準耦合管道幾乎相同。但是，執行結束時，在測試步驟之後，會出現一個「**提升組建版本**」按鈕。透過此按鈕，您可以使用在執行中繼階段部署的成品來啟動僅限生產管道執行，並將它們部署到生產環境。

![僅限中繼管道執行](/help/assets/configure-pipelines/stage-only-pipeline-run.png)

按一下「**升級組建**」會提示您確認相關僅限生產管道是否正常或在[緊急模式](#emergency-mode)中執行。

如果不存在僅限生產管道，系統會提示您建立一個。

### 僅限生產管道 {#prod-only-run}

對於僅限生產管道，請務必識別您想要部署到生產環境的來源成品。這些詳細資訊可於&#x200B;**成品準備**&#x200B;步驟中找到。您可以瀏覽到這些執行以取得更多詳細資訊和記錄。

![成品詳細資訊](/help/assets/configure-pipelines/prod-only-pipeline-run.png)

