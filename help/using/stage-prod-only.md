---
title: 僅限中繼和僅限生產管道
description: 了解如何使用專用管道分割中繼和生產部署。
exl-id: b7dd0021-d346-464a-a49e-72864b01cce3
source-git-commit: 77eb1c824ba766e43dfd8e2b0f6f6edc71f043e5
workflow-type: tm+mt
source-wordcount: '943'
ht-degree: 31%

---

# 僅限中繼和僅限生產的管道 {#stage-prod-only}

了解如何使用專用管道分割中繼和生產部署。

>[!NOTE]
>
>此功能僅適用於[早期採用者程式](/help/release-notes/current.md#early-adoption)。

## 概觀 {#overview}

中繼環境和生產環境緊密耦合。依預設，其部署連結到單一管道。也就是說，部署管道會部署到該計畫中的中繼和生產環境。 雖然這種耦合通常是合適的，但對某些使用案例會有缺點：

* 如果您只想部署至階段，請拒絕管道中的&#x200B;**升級至生產環境**&#x200B;步驟。 但是，執行會標示為已取消。
* 如果您想要在中繼環境中將最新的計畫碼部署到生產環境，則需要重新部署整個管道，包括中繼部署，即使那裡未變更計畫碼。
* 部署期間無法更新環境。 如果您在升級到生產之前在中繼環境中暫停測試數天，則生產環境會維持鎖定狀態，且無法更新。 此情境會使非相依性工作（例如更新[環境變數](/help/getting-started/build-environment.md#environment-variables)）變成不可能。

僅限中繼和僅限生產管道透過提供專用部署選項為這些使用案例提供解決方案。

* **僅限中繼的部署管道：**&#x200B;僅部署至中繼環境，並會在部署和測試完成後執行完成。 僅限中繼管道的行為與標準耦合全端生產管道相同，但沒有生產部署步驟 (核准、排程、部署)。
* **僅限生產環境的部署管道：**&#x200B;選取成功的階段執行，僅部署到生產環境。 然後將成品部署至生產環境。 僅限生產用的管道會重複使用階段部署人工因素，略過建置階段。

全棧疊生產管道正在進行時，僅階段和僅生產管道不會執行，反之亦然。 如果僅限階段和全端生產管道都設定了「**進行 Git 變更**」觸發程序，並且指向相同的分支和存放庫，則只有僅限階段管道會自動啟動。僅限Prod的管道不會啟動&#x200B;**`On Git Changes`**，因為它們未直接連結至存放庫。

僅生產管道是手動觸發，因為它們未直接連結到&#x200B;**Git變更**&#x200B;的存放庫。

這些專用管道可提供更多彈性，但您應留意下列操作詳細資訊和建議。

>[!NOTE]
>
>僅限Prod的管道一律會使用僅限舞台管道的成品。 即使標準耦合生產管道在此期間已將其他部署至暫存環境，此程式依然有效。
>
>* 這類情況可能會導致不必要的程式碼倒回。
>* Adobe 建議在開始使用僅限生產和僅限中繼管道後，停止使用標準耦合生產管道。
>* 如果您仍然決定執行標準耦合管道和僅限中繼/僅限生產管道，請記住重複使用成品以避免程式碼回復。

## 管道建立 {#pipeline-creation}

僅生產管道和僅中繼管道的建立方式與標準耦合[生產管道](/help/using/production-pipelines.md)和[非生產管道](/help/using/non-production-pipelines.md)類似。 如需詳細資訊，請參閱這些檔案。

1. 在&#x200B;**管道**&#x200B;視窗中，按一下&#x200B;**新增管道**。

   * 選取&#x200B;**新增非生產管道**&#x200B;以建立僅限中繼管道。
   * 選取&#x200B;**新增僅限生產管道**&#x200B;以建立僅限生產管道。

   ![建立僅限生產/中繼管道](/help/assets/configure-pipelines/prod-stage-pipelines.png)

>[!NOTE]
>
>如果對應的管道已存在，特定選項可能會呈現灰色。
>
>* 如果僅限中繼的管道尚不存在，則&#x200B;**無法新增僅限生產的管道**。
>* 如果標準耦合管道已存在，**新增生產管道**&#x200B;將無法使用。
>* 每個方案僅允許一個僅限生產管道和一個僅限中繼管道。

### 僅限中繼的管道 {#stage-only}

1. 一旦您選取&#x200B;**新增非生產管道**&#x200B;選項，**新增非生產管道**&#x200B;對話方塊就會開啟。
1. 若要建立僅限中繼管道，請在管道的&#x200B;**合格的部署環境**&#x200B;欄位中選取中繼環境。完成其餘欄位，然後按一下[繼續]。****

   ![建立僅限中繼管道](/help/assets/configure-pipelines/stage-only.png)

1. 在&#x200B;**中繼測試**&#x200B;索引標籤上，您可以定義應在中繼環境中執行的測試。 按一下&#x200B;**儲存**&#x200B;以儲存您的新管道。

   ![僅限中繼管道的測試參數](/help/assets/configure-pipelines/stage-only-test.png)

### 僅限生產用的管道 {#prod-only}

1. 選取&#x200B;**僅新增生產管道**&#x200B;選項後，**僅新增生產管道**&#x200B;對話方塊會開啟。
1. 提供&#x200B;**管道名稱**。對話方塊的其餘選項和功能與在標準耦合配管建立對話方塊中找到的選項相同。 按一下&#x200B;**儲存**&#x200B;以儲存管道。

   ![建立僅限生產管道](/help/assets/configure-pipelines/prod-only-pipeline.png)

## 執行prod-only和stage-only管道 {#running}

僅限生產及僅限舞台管道的執行方式與[所有其他管道的執行方式大致相同。](/help/using/managing-pipelines.md#running-pipelines)請參閱檔案以取得詳細資料。 但是，這些配管有兩個新特徵。

* 僅限階段和僅限生產環境的管道提供新的[緊急模式](#emergency-mode)，以允許略過測試。
* 只能從[僅中繼管道的執行詳細資料直接觸發僅限生產管道執行。](#stage-only-run)

### 緊急模式 {#emergency-mode}

每當您啟動僅限生產和中繼線上的管道時，系統會提示您確認啟動以及其啟動方式。

* **正常模式**&#x200B;是標準執行，包含中繼測試步驟。
* **緊急模式**&#x200B;略過階段測試步驟。

![緊急模式](/help/assets/configure-pipelines/emergency-mode.png)

### 僅限中繼的管道 {#stage-only-run}

僅限中繼管道的執行方式與標準耦合管道幾乎相同。不過，在執行結束時，在測試步驟之後，會顯示&#x200B;**Promote Build**&#x200B;按鈕。 此按鈕可讓您使用執行中部署在階段上的成品來啟動僅限生產環境的管道執行，並將它們部署到生產環境。

![僅限中繼管道執行](/help/assets/configure-pipelines/stage-only-pipeline-run.png)

按一下&#x200B;**升級組建**&#x200B;會提示您確認相關階段專用管道是否正常或以[緊急模式執行。](#emergency-mode)

如果僅生產管線不存在，系統將提示您建立管線。

### 僅限生產用的管道 {#prod-only-run}

對於僅限生產環境的管道，請務必識別要部署到生產環境的來源人工因素。 這些詳細資訊可以在&#x200B;**成品準備**&#x200B;步驟中找到。您可以導覽到這些執行以獲取更多詳細資訊和記錄。

![成品詳細資訊](/help/assets/configure-pipelines/prod-only-pipeline-run.png)
